/* io_i
 * Author: Szegedi Gábor D071PO
 * Creation date: 2018-06-29
 */
IMPLEMENTATION io_i
REFINES io

IMPORTS
    BASIC_IO
    
DEFINITIONS
    "constants.def"
    
CONCRETE_VARIABLES
   io_status
    
INITIALISATION
    io_status := IO_INITIALIZING
    
OPERATIONS
    a_array <--read_a =
    BEGIN
        STRING_WRITE("Kérek |");
        INT_WRITE(arraySize);
        STRING_WRITE("| darab számot |");
        INT_WRITE(minValue);
        STRING_WRITE("| és |");
        INT_WRITE(maxValue);
        STRING_WRITE("| között! Elrakom őket az 'A' tömbbe.\n");

        VAR index, readint, size IN
            index := 0;
            readint := minValue;
            size := arraySize;
            a_array := (0..arraySize - 1)*{minValue};
			WHILE index < size DO
			    readint <-- INTERVAL_READ( minValue, maxValue );
			    a_array(index) := readint;
                index := index + 1
			INVARIANT
				index : 0..size
				& a_array : 0..arraySize - 1 --> minValue .. maxValue
			VARIANT
				size-index
			END
		END;
		STRING_WRITE("'A' tömb beolvasva.\n");
        io_status := IO_A_READ
    END;

    b_array <--read_b =
    BEGIN
        STRING_WRITE("Kérek |");
        INT_WRITE(arraySize);
        STRING_WRITE("| darab számot |");
        INT_WRITE(minValue);
        STRING_WRITE("| és |");
        INT_WRITE(maxValue);
        STRING_WRITE("| között úgy, hogy minden szám kisebb legyen az előzőnél! Elrakom őket a 'B' tömbbe.\n");

        VAR index, readint, size IN // TODO: Remove size? Replace it with arraySize 
            index := 0;
            readint := minValue;
            size := arraySize;
            b_array := (0..arraySize - 1)*{minValue};
			WHILE index < size DO
			    readint <-- INTERVAL_READ( minValue, maxValue ); // TOOO: Store the previous read value as max and replace maxValue with it.
			    b_array(index) := readint;
                index := index + 1
			INVARIANT
				index : 0..size
				& b_array : 0..arraySize - 1 --> minValue .. maxValue
				//& !i.(i : 1..index-1 => b_array(i) < b_array(i-1))
			VARIANT
				size-index
			END
		END;
		STRING_WRITE("'B' tömb beolvasva.\n");
        io_status := IO_B_READ
    END;
    
    write_result(c_array, special_element_found, special_element_index) =
    BEGIN
        STRING_WRITE("'A' és 'B' tömb elemein páronként az alábbi műveletet végezzük el:\n");
        STRING_WRITE("19*a[i] + (-9)*b_array[i] + 4\n");
        STRING_WRITE("Az így kapott sorozat a következő:\n");
        VAR index, size IN
            index := 0;
            size := arraySize;
            WHILE index /= size DO
                INT_WRITE(index + 1);
                STRING_WRITE(". = ");
                INT_WRITE(c_array(index));
                STRING_WRITE("\n");
                index := index + 1
            INVARIANT
                index : 0..arraySize
                & c_array : 0..arraySize - 1 --> INT
            VARIANT
                size-index
        	END
        END;
        IF special_element_found = TRUE THEN
            STRING_WRITE("A kapott sorozat egyik elemére igaz az, hogy c_array[index] mod 32 = 25");
            STRING_WRITE("Index értéke: |");
            INT_WRITE(special_element_index);
            STRING_WRITE("|\n")
        ELSE
            STRING_WRITE("A kapott sorozat egyik elemére sem igaz az, hogy c_array[index] mod 32 = 25");
        END;
        io_status := IO_WRITTEN
    END
 END